# Режим "Фильм" - Анализ лучших моментов видео

## Обзор

Режим "Фильм" предназначен для анализа длинных видео и автоматического выделения лучших моментов для создания компиляции. В отличие от режима shorts (создание отдельных коротких видео), режим фильм фокусируется на анализе всего контента и предложении оптимальных фрагментов.

## Возможности

- **Анализ длинных видео**: Обработка видео любой длительности
- **Интеллектуальный поиск моментов**: Использование ИИ для выявления самых engaging фрагментов
- **Два типа моментов**:
  - **COMBO** (10-20 сек): Склейка 2-4 коротких кусков из одной сцены
  - **SINGLE** (30-60 сек): Один самодостаточный момент
- **Ранжирование по критериям**: Эмоциональные пики, конфликт, остроумие, цитатность и др.
- **Обрезка скучных секунд**: Автоматическое удаление пауз и филлеров
- **JSON вывод**: Структурированные результаты с метаданными

## Запуск

1. Запустите main.py:
```bash
python main.py
```

2. Выберите опцию "3. Process Film Mode (analyze best moments)"

3. Выберите источник видео:
   - YouTube URL
   - Локальный файл

4. Дождитесь завершения анализа

## Результаты

После анализа создается JSON файл в папке `film_analysis_results/` со следующей структурой:

```json
{
  "video_id": "master-ABC123",
  "duration": 1800.5,
  "keep_ranges": [
    {
      "start": 125.3,
      "end": 145.8,
      "type": "SINGLE",
      "score": 8.7,
      "text": "Ключевой момент обсуждения..."
    }
  ],
  "scores": [
    {
      "moment_id": "single_1",
      "emotional_peaks": 8.5,
      "conflict_escalation": 7.2,
      "punchlines_wit": 9.1,
      "quotability_memes": 8.8,
      "stakes_goals": 7.9,
      "hooks_cliffhangers": 6.5,
      "visual_penalty": 0.5,
      "total": 8.7
    }
  ],
  "preview_text": "Фильм содержит 12 лучших моментов...",
  "risks": ["Возможные проблемы или предупреждения"],
  "metadata": {
    "processed_at": "2025-01-15T10:30:00Z",
    "model_version": "gemini-2.5-flash",
    "total_segments_analyzed": 45
  }
}
```

## Критерии ранжирования

### Эмоциональные пики и переломы статуса (20%)
- Признания, угрозы, ультиматумы
- Резкие смены намерения ("Я ухожу", "Мы всё теряем")
- Переломные моменты в повествовании

### Конфликт и эскалация (18%)
- Прямые столкновения
- Оскорбления, отрицания
- Нарастание напряжения

### Панчлайны и остроумие (16%)
- Связка сетап → поворот → панч
- Сарказм, самоирония
- Остроумные замечания

### Цитатность/мемность (14%)
- Запоминающиеся фразы
- Афоризмы, каламбуры
- Потенциал для распространения

### Ставки и цель (12%)
- "Если X, то Y"
- "Последний шанс"
- Важные решения

### Крючки/клиффхэнгеры (10%)
- Вопросы без ответа
- Недосказанность
- Обещание развития

### Штраф за визуальную зависимость (-10%)
- Зависимость от визуального контекста
- Сложность понимания без картинки

## Конфигурация

Настройки режима фильм находятся в `config.yaml`:

```yaml
film_mode:
  enabled: true
  combo_duration: [10, 20]      # секунды для COMBO
  single_duration: [30, 60]     # секунды для SINGLE
  max_moments: 15               # максимум моментов
  pause_threshold: 0.7          # порог пауз
  filler_words: ["э-э", "м-м", "ну", "эээ", "гм", "кхм"]

  ranking_weights:
    emotional_peaks: 0.20
    conflict_escalation: 0.18
    punchlines_wit: 0.16
    quotability_memes: 0.14
    stakes_goals: 0.12
    hooks_cliffhangers: 0.10
    visual_penalty: -0.10
```

## Архитектура

### Основные компоненты:
- **FilmMode.py**: Основной анализатор фильмов
- **FilmAnalyzer**: Класс для анализа видео
- **LanguageTasks**: Расширенные функции ИИ-анализа
- **config.py**: Конфигурация с FilmModeConfig

### Интеграция:
- **YoutubeDownloader**: Загрузка видео
- **Transcription**: Транскрибация с таймкодами
- **Database**: Кеширование результатов

## Использование результатов

1. **keep_ranges**: Таймкоды лучших моментов для монтажа
2. **scores**: Детальная оценка каждого момента
3. **preview_text**: Краткое описание содержания
4. **risks**: Предупреждения о потенциальных проблемах

## Примеры использования

### Создание фильма из лучших моментов:
```python
from Components.FilmMode import analyze_film_main

result = analyze_film_main(url="https://youtube.com/watch?v=...")
print(f"Найдено {len(result.keep_ranges)} моментов")
```

### Анализ локального файла:
```python
result = analyze_film_main(local_path="video.mp4")
```

## Советы по использованию

1. **Длинные видео**: Лучше работают с видео 10+ минут
2. **Качественная транскрибация**: Влияет на качество анализа
3. **Настройка весов**: Адаптируйте под тип контента
4. **Проверка результатов**: Всегда просматривайте keep_ranges

## Устранение неполадок

- **Нет моментов найдено**: Проверьте качество аудио и транскрибации
- **Низкие оценки**: Возможно, видео не содержит engaging контент
- **Ошибки загрузки**: Проверьте доступность видео и стабильность интернета

## Будущие улучшения

- Поддержка дополнительных критериев ранжирования
- Интеграция с видео-редакторами
- Пакетная обработка нескольких видео
- Экспорт в популярные форматы монтажа